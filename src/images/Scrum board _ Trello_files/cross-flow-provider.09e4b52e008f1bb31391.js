(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{"./app/gamma/src/util/cross-flow-essentials.ts":function(e,n,t){"use strict";t.d(n,"b",(function(){return a})),t.d(n,"f",(function(){return c})),t.d(n,"e",(function(){return u})),t.d(n,"d",(function(){return l})),t.d(n,"a",(function(){return d})),t.d(n,"c",(function(){return m}));var r=t("./packages/config/index.ts"),o=t("./packages/atlassian-analytics/index.ts"),i=t("./node_modules/@atlassiansox/cross-flow-support/dist/esm/index.js");let a;!function(e){e.ATLASSIAN_SWITCHER="atlassian_switcher",e.PRODUCT_STORE="product_store",e.CROSSFLOW_ESSENTIALS="cross_flow_essentials_v2",e.TOUCHPOINTS_JSW_BOARD="trello_jsw_touchpoints_board",e.TOUCHPOINTS_JSW_POWERUPS="trello_jsw_touchpoints_powerups",e.TOUCHPOINTS_JSW_SWITCHER="trello_jsw_touchpoints_switcher",e.TOUCHPOINTS_CONFLUENCE_SWITCHER="trello_confluence_touchpoints_switcher",e.TOUCHPOINTS_CONFLUENCE_POWERUPS="trello_confluence_touchpoints_powerups"}(a||(a={}));const s=({campaign:e})=>"utm_source=trello&utm_medium=in_product_ad&utm_campaign=".concat(e),c=e=>{const n=s(e);window.open("".concat(r.wacUrl,"/software?").concat(n),"_blank")},u=(e,n)=>{const t=s(n);if(e===i.a.OPSGENIE)return void window.open("".concat(r.wacUrl,"/software/opsgenie/try?").concat(t),"_blank");const o={[i.a.JIRA_SOFTWARE]:"jira-software",[i.a.JIRA_SERVICE_DESK]:"jira-service-desk",[i.a.CONFLUENCE]:"confluence"}[e];o?window.open("".concat(r.wacUrl,"/try/cloud/signup?bundle=").concat(o,"&edition=free&").concat(t),"_blank"):c(n)},l=(e,n,t)=>{const r=[];function o(e){r.length<5&&r.push(e)}for(const t of e){if(5===r.length)break;r.push(t.displayName);const e=n.filter((e=>e.idEnterprise===t.id));e.forEach((e=>{o("".concat(t.displayName,"-").concat(e.displayName))})),e.forEach((e=>{o(e.displayName)}))}return n.forEach((e=>{e.idEnterprise||o(e.displayName)})),t&&t.name&&o(t.name),r},d="".concat(r.atlassianApiGateway,"gateway/api/available-products/api/available-products"),p="".concat(r.siteDomain,"/proxy/experiment-api/trello-cross-product-join/available-sites"),m=async e=>{try{const n=e?d:p,t=await fetch(n,{method:"GET",credentials:"include",headers:{"X-Trello-Client-Version":r.clientVersion}});if(t.ok)return t.json();throw new Error("unauthorized")}catch(e){return o.Analytics.sendOperationalEvent({action:"errored",actionSubject:"fetchAvailableSites",source:"crossFlowEssentials"}),{sites:[]}}}},"./app/src/components/CrossFlowProvider/CrossFlowProvider.tsx":function(e,n,t){"use strict";t.r(n),t.d(n,"CrossFlowProvider",(function(){return w}));var r=t("./node_modules/react/index.js"),o=t.n(r),i=t("./app/gamma/src/util/cross-flow-essentials.ts"),a=t("./packages/config/index.ts"),s=t("./node_modules/@atlassiansox/cross-flow-support/dist/esm/trello.js"),c=t("./packages/atlassian-analytics/index.ts"),u="GetSuggestedSiteNames",l="GetAvailableSites",d=t("./packages/error-reporting/index.ts"),p=t("./node_modules/@apollo/client/react/hooks/useQuery.js");t("./node_modules/@apollo/client/react/hooks/useLazyQuery.js");function m(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function f(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?m(Object(t),!0).forEach((function(n){b(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):m(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function b(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}const v={context:{operationName:"CrossFlowProvider"}},O={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"CrossFlowProvider"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"memberId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"member"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"memberId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"idPremOrgsAdmin"}},{kind:"Field",name:{kind:"Name",value:"isAaMastered"}},{kind:"Field",name:{kind:"Name",value:"fullName"}},{kind:"Field",name:{kind:"Name",value:"prefs"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locale"}}]}},{kind:"Field",name:{kind:"Name",value:"enterprises"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"displayName"}}]}},{kind:"Field",name:{kind:"Name",value:"organizations"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"idEnterprise"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"url"}}]}}]}}]}}]};const j="prod"===a.environment?"production":"staging",y=a.atlassianApiGateway.endsWith("/")?a.atlassianApiGateway.substr(0,a.atlassianApiGateway.length-1):a.atlassianApiGateway,w=({children:e})=>{var n,t,r;const{data:a}=function(e){const n=f(f({},v),e);return p.a(O,n)}({variables:{memberId:"me"}}),m=a&&(null==a?void 0:a.member),b=null!==(n=null==m?void 0:m.enterprises)&&void 0!==n?n:[],w=null!==(t=null==m?void 0:m.organizations)&&void 0!==t?t:[],h=Boolean(null==m?void 0:m.isAaMastered),E={id:(null==m?void 0:m.id)||"",idPremOrgsAdmin:(null==m?void 0:m.idPremOrgsAdmin)||[],isAaMastered:h,name:(null==m?void 0:m.fullName)||"",enterprises:b},k=(null==m||null===(r=m.prefs)||void 0===r?void 0:r.locale)||"en",g=function(e){return[u,e]}((async()=>Object(i.d)(b,w,E))),_=function(e){return[l,e]}((async()=>Object(i.c)(h)));return o.a.createElement(s.a,{analyticsClient:c.Analytics.dangerouslyGetAnalyticsWebClient(),locale:k,edgePrefix:y,isAaMastered:h,env:j,plugins:[g,_],onError:e=>{Object(d.sendErrorEvent)(e,{tags:{ownershipArea:"trello-workflowers"},extraData:{component:"CrossFlowProvider"}})}},e)}},"./node_modules/@atlassiansox/cross-flow-api-internals/dist/esm/index.js":function(e,n,t){"use strict";t.d(n,"a",(function(){return d})),t.d(n,"d",(function(){return p})),t.d(n,"b",(function(){return a})),t.d(n,"c",(function(){return s}));t("./node_modules/@babel/runtime/helpers/extends.js");var r=t("./node_modules/react/index.js"),o=t.n(r),i=function(e){return{open:function(n){return e(n)}}},a={GET_STARTED:"get-started",DECIDE:"decide",DISCOVER:"discover"},s={CONFLUENCE:"confluence.ondemand",JIRA_CORE:"jira-core.ondemand",JIRA_SERVICE_DESK:"jira-servicedesk.ondemand",JIRA_SOFTWARE:"jira-software.ondemand",BITBUCKET:"bitbucket.ondemand",TRELLO:"trello",OPSGENIE:"opsgenie",STATUSPAGE:"statuspage",TEAM_CENTRAL:"townsquare",AVOCADO:"avocado"},c="Could not provide requested API version",u="Provider not found",l=Object(r.createContext)((function(){return{isEnabled:!1,reason:u}})),d=function(e){var n=e.onOpen,t=e.children,a=Object(r.useMemo)((function(){return function(e){return function(n){switch(n){case 0:return{isEnabled:!0,api:i(e)};default:return{isEnabled:!1,reason:c}}}}(n)}),[n]);return o.a.createElement(l.Provider,{value:a},t)},p=function(){var e=Object(r.useContext)(l);return Object(r.useMemo)((function(){return e(0)}),[e])}},"./node_modules/@atlassiansox/cross-flow-support/dist/esm/index.js":function(e,n,t){"use strict";t.d(n,"b",(function(){return r.d})),t.d(n,"a",(function(){return r.c}));var r=t("./node_modules/@atlassiansox/cross-flow-api-internals/dist/esm/index.js");t("./node_modules/@babel/runtime/regenerator/index.js"),t("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),t("./node_modules/@babel/runtime/helpers/asyncToGenerator.js"),t("./node_modules/react/index.js")},"./node_modules/@atlassiansox/cross-flow-support/dist/esm/lib/redirects-helpers/redirectsHelpers.js":function(e,n,t){"use strict";t.d(n,"a",(function(){return l}));var r,o=t("./node_modules/@babel/runtime/helpers/defineProperty.js"),i=t.n(o),a=t("./node_modules/@atlassiansox/cross-flow-api-internals/dist/esm/index.js");!function(e){e["atlassian-switcher"]="atlassian_switcher"}(r||(r={}));var s={"atlassian-switcher":r["atlassian-switcher"]},c=function(e,n){var t="";return e&&function(e){return Boolean(s[e])}(e)&&(t+="utm_campaign=".concat(s[e],"&utm_medium=in_product_ad"),n&&(t+="&utm_source=".concat(n))),t},u=function(e,n,t,r){var o="staging"===n?"https://qa-wac.internal.atlassian.com":"https://www.atlassian.com",s=c(t,r),u="",l="",d="/software";return!function(e){return[a.c.JIRA_SOFTWARE,a.c.JIRA_SERVICE_DESK,a.c.JIRA_CORE,a.c.CONFLUENCE].includes(e)}(e)?function(e){return[a.c.OPSGENIE].includes(e)}(e)&&(d=function(e){return i()({},a.c.OPSGENIE,"/software/opsgenie/try")[e]}(e)):(d="/try/cloud/signup",l=function(e){var n,t=(n={},i()(n,a.c.JIRA_SOFTWARE,"jira-software"),i()(n,a.c.JIRA_SERVICE_DESK,"jira-service-desk"),i()(n,a.c.JIRA_CORE,"jira-core"),i()(n,a.c.CONFLUENCE,"confluence"),n);return"bundle=".concat(t[e],"&edition=free")}(e)),l&&(u+="?".concat(l)),s&&(u=u+(u?"&":"?")+s),o+d+u},l=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"production",t=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=u(e,n,t,r);window.open(o,"_blank")}},"./node_modules/@atlassiansox/cross-flow-support/dist/esm/trello.js":function(e,n,t){"use strict";t.d(n,"b",(function(){return K.b}));var r=t("./node_modules/@babel/runtime/helpers/extends.js"),o=t.n(r),i=t("./node_modules/react/index.js"),a=t.n(i),s=t("./node_modules/@babel/runtime/helpers/slicedToArray.js"),c=t.n(s),u=t("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),l=t.n(u),d=t("./node_modules/@atlassiansox/cross-flow-api-internals/dist/esm/index.js"),p=t("./node_modules/@atlaskit/analytics-gas-types/dist/esm/index.js"),m=t("./node_modules/@babel/runtime/helpers/defineProperty.js"),f=t.n(m);function b(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function v(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?b(Object(t),!0).forEach((function(n){f()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):b(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var O=function(e){return function(e,n){return n.reduce((function(n,t){return e.forEach((function(e){var r=t?t[e]:null;n.push(r||t[e])})),n}),[]).filter(Boolean)}(["source"],e)},j=function(e){return e[e.length-1]},y=function(e){var n=e.context,t=e.payload;if(!t)return null;var r=O(n),o=j(r)||p.a,i=function(e){return e.reduce((function(e,n){var t=n.attributes,r=l()(n,["attributes"]),o=v(v({},e),r);return t?v(v({},o),t):o}),{})}(n),a=j(function(e){return e.map((function(e){return{packageName:e.packageName,packageVersion:e.packageVersion}})).filter((function(e){return e.packageName}))}(n))||{},s=a.packageName,c=void 0===s?void 0:s,u=a.packageVersion,d=void 0===u?void 0:u,m=t.eventType,f=void 0===m?p.e:m,b=t.action,y=t.actionSubject,w=t.actionSubjectId,h=t.attributes,E=t.name,k=v(v({packageName:c,packageVersion:d},i),h),g=t.tags||[];switch(g.push("growth"),f){case p.e:case p.b:case p.d:return{eventType:f,source:o,actionSubject:y,action:b,actionSubjectId:w,attributes:k,tags:g.slice(0)};case p.c:return{eventType:f,name:E,attributes:k,source:o,tags:g.slice(0)}}return null},w=t("./node_modules/@atlassiansox/cross-flow-support/dist/esm/lib/redirects-helpers/redirectsHelpers.js"),h=t("./node_modules/@babel/runtime/helpers/classCallCheck.js"),E=t.n(h),k=t("./node_modules/@babel/runtime/helpers/createClass.js"),g=t.n(k),_=t("./node_modules/@babel/runtime/helpers/assertThisInitialized.js"),S=t.n(_),P=t("./node_modules/@babel/runtime/helpers/inherits.js"),N=t.n(P),C=t("./node_modules/@babel/runtime/helpers/possibleConstructorReturn.js"),A=t.n(C),T=t("./node_modules/@babel/runtime/helpers/getPrototypeOf.js"),x=t.n(T),I="crossFlowProvider",R="crossFlowSupport";function F(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,r=x()(e);if(n){var o=x()(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return A()(this,t)}}var D={eventType:p.b,action:"errorCaught",actionSubject:"errorBoundary"},U=[{source:I},{packageName:"@atlassiansox/cross-flow-support",packageVersion:"1.4.1"}],W=function(e){N()(t,e);var n=F(t);function t(){var e;E()(this,t);for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];return e=n.call.apply(n,[this].concat(o)),f()(S()(e),"state",{hasError:!1}),e}return g()(t,[{key:"componentDidCatch",value:function(e){this.props.onAnalyticsEvent({payload:D,context:U}),this.props.onError&&this.props.onError(e)}},{key:"render",value:function(){return this.state.hasError?null:this.props.children}}],[{key:"getDerivedStateFromError",value:function(){return{hasError:!0}}}]),t}(i.Component);function G(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function J(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?G(Object(t),!0).forEach((function(n){f()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):G(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var V={version:"1.4.1"};function L(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function H(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?L(Object(t),!0).forEach((function(n){f()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):L(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var M,z=function(e,n){if(!n)return e;var t=H(H({},e.attributes||{}),{},{sourceComponent:n.sourceComponent,sourceContext:n.sourceContext});return H(H({},e),{},{attributes:t})},B=(M=a.a.lazy((function(){return t.e(33).then(t.bind(null,"./node_modules/@atlassiansox/cross-flow-support/dist/esm/lib/view/index.js"))})),function(e){var n=e.children,t=e.analyticsClient,r=e.originProduct,s=e.redirectToWac,u=e.env,m=e.plugins,f=void 0===m?[]:m,b=e.onError,v=l()(e,["children","analyticsClient","originProduct","redirectToWac","env","plugins","onError"]),O=Object(i.useRef)(),j=Object(i.useState)(!1),h=c()(j,2),E=h[0],k=h[1],g=Object(i.useMemo)((function(){return function(e){return function(n){return Promise.resolve(e).then((function(e){switch(n.eventType){case p.e:e.sendUIEvent(n);break;case p.d:e.sendTrackEvent(n);break;case p.b:e.sendOperationalEvent(n);break;case p.c:e.sendScreenEvent(n)}}))}}(t)}),[t]),_=Object(i.useState)(),S=c()(_,2),P=S[0],N=S[1],C=Object(i.useCallback)((function(e){var n,t,r=y(e);if(r){var o=z((t=J(J({},(n=r).attributes||{}),{},{crossFlowSupport:V}),J(J({},n),{},{attributes:t})),P);g(o)}}),[g,P]),A=Object(i.useCallback)((function(e){E||(C({payload:{eventType:p.b,action:"uiInitialized",actionSubject:R,attributes:{appName:e}},context:[{source:I}]}),k(!0))}),[E,C]),T=Object(i.useCallback)((function(e){k(!1);var n={payload:z({eventType:p.b,action:"openInvoked",actionSubject:R},e),context:[{source:I}]};return C(n),e.journey===d.b.GET_STARTED&&s?(Object(w.a)(e.targetProduct,u,e.sourceComponent,e.sourceContext),Promise.resolve({})):(N(e),new Promise((function(e){O.current=e})))}),[C,u,s]),x=Object(i.useCallback)((function(e){k(!1),N(void 0),O.current&&O.current(e)}),[]);return a.a.createElement(d.a,{onOpen:T},n,P&&a.a.createElement(W,{onAnalyticsEvent:C,onError:b},a.a.createElement(i.Suspense,{fallback:null},a.a.createElement(M,o()({},v,P,{onAnalyticsEvent:C,originProduct:r,onClose:x,onHandShake:A,plugins:f,env:u,redirectToWac:s})))))}),K=t("./node_modules/@atlassiansox/cross-flow-support/dist/esm/index.js");n.a=function(e){var n=!e.isAaMastered;return a.a.createElement(B,o()({},e,{shouldUseCFFEOverride:function(){return!0},originProduct:"trello",redirectToWac:n}))}}},0,[33]]);
//# sourceMappingURL=cross-flow-provider.09e4b52e008f1bb31391.js.map