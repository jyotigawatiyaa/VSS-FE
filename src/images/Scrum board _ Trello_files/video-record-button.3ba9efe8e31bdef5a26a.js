(window.webpackJsonp=window.webpackJsonp||[]).push([[214],{"./app/src/components/VideoRecordButton/VideoRecordButton.tsx":function(e,t,o){"use strict";o.r(t),o.d(t,"VideoRecordButton",(function(){return V}));var s=o("./node_modules/react/index.js"),n=o.n(s),c=o("./node_modules/classnames/index.js"),r=o.n(c),a=o("./packages/nachos/src/components/Icon/index.ts");const i=()=>n.a.createElement("svg",{width:"24",height:"24",role:"presentation",focusable:"false",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},n.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.85582 7C3.83048 7 3 7.74683 3 8.66889V15.3311C3 16.2532 3.83048 17 4.85582 17H14.1442C15.1695 17 16 16.2532 16 15.3311V15.0308L19.7575 15.9702C20.0562 16.0448 20.3727 15.9777 20.6154 15.7882C20.8581 15.5987 21 15.3079 21 15V9.00001C21 8.69207 20.8581 8.40131 20.6154 8.2118C20.3727 8.0223 20.0562 7.95518 19.7575 8.02987L16 8.96923V8.66889C16 7.74683 15.1695 7 14.1442 7H4.85582ZM5 15V9H14V15H5ZM16 11.0002V12.9998C16.08 12.9998 16.1614 13.0096 16.2425 13.0299L19 13.7192V10.2808L16.2425 10.9702C16.1614 10.9904 16.08 11.0002 16 11.0002Z",fill:"currentColor"})),l=e=>{const{testId:t,dangerous_className:o,size:s,color:c,label:r,block:l}=e;return n.a.createElement(a.a,{testId:t,size:s,dangerous_className:o,color:c,block:l,label:r||"VideoIcon",glyph:i})};var d=o("./packages/nachos/tooltip.ts"),u=o("./packages/i18n/index.ts"),p=o("./packages/atlassian-analytics/index.ts"),m=o("./packages/config/index.ts"),b=o("./packages/browser/index.ts"),g=o("./packages/error-reporting/index.ts"),h=o("./app/scripts/debug/constants.ts");function j(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}class v{constructor(){if(j(this,"instance",void 0),j(this,"promise",void 0),Object(b.isCypress)())return void(this.instance={});const e={apiKey:m.loomApiKey};this.promise=o.e(114).then(o.bind(null,"./node_modules/@loomhq/loom-sdk/dist/esm/index.js")).then((({setup:t,isSupported:o})=>o()?t(e).then((e=>{const{success:t}=e.status();return t||p.Analytics.sendOperationalEvent({action:"errored",actionSubject:"fetchLoomSDK",source:"videoRecordButton"}),e})).catch((e=>{Object(g.sendErrorEvent)(e,{tags:{ownershipArea:"trello-teamplates",feature:h.Feature.VideoRecordButton}})})):null))}async waitOnInstance(){if(this.instance)return this.instance;const e=await this.promise;return this.instance=e,e}}let f;var k=o("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),y=o.n(k),w=o("./node_modules/css-loader/dist/cjs.js?!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/less-loader/dist/cjs.js?!./app/src/components/VideoRecordButton/VideoRecordButton.less"),C={insert:"head",singleton:!1},R=(y()(w.a,C),w.a.locals||{}),O=o("./app/src/components/VideoRecordButton/useLoomSDK.ts"),B=o("./packages/keybindings/index.ts"),E=o("./app/scripts/lib/trello-clipboard.js");const x=Object(u.forTemplate)("list"),V=({id:e,insert:t,analyticsSource:o,analyticsContainers:c,iconColor:a,className:i="",showTooltip:u})=>{const[m,g]=Object(O.a)(),[h,j]=Object(s.useState)(!1),[k,y]=Object(s.useState)(),w=Object(s.useRef)(null);Object(s.useEffect)((()=>{let e;if(h){const t=500;e=window.setInterval((()=>{const t=null==m?void 0:m.status().state;y(t),"closed"===t&&(clearInterval(e),j(!1))}),t)}return()=>{e&&clearInterval(e)}}),[h,m]),Object(s.useEffect)((()=>(k&&("closed"===k||"active-recording"===k?(Object(B.resumeShortcuts)(),E.trelloClipboard.resumeShortcuts()):(Object(B.pauseShortcuts)(),E.trelloClipboard.pauseShortcuts())),()=>{Object(B.resumeShortcuts)(),E.trelloClipboard.resumeShortcuts()})),[k]),Object(s.useEffect)((()=>{Object(b.isEdgeLegacy)()||Object(b.isYandex)()||async function(){var e;const t=await(null===(void 0===f&&(f=new v),e=f)||void 0===e?void 0:e.waitOnInstance());m||g(t)}()}),[m,g]),Object(s.useLayoutEffect)((()=>{if(null!=w&&w.current&&m){let e="";null==m||m.configureButton({element:w.current,hooks:{onInsertClicked:e=>{Promise.resolve(t(e.sharedUrl)).then((()=>{document.activeElement instanceof HTMLIFrameElement&&document.activeElement.blur()})),p.Analytics.sendClickedButtonEvent({buttonName:"insertRecordingButton",source:"loomRecordingModal",containers:c})},onStart:()=>{e=p.Analytics.startTask({taskName:"loom-recording",source:"loomRecordingModal",containers:c})},onCancel:()=>{p.Analytics.taskAborted({taskName:"loom-recording",traceId:e,source:"videoRecordButton",containers:c})},onComplete:()=>{p.Analytics.taskSucceeded({taskName:"loom-recording",traceId:e,source:"videoRecordButton",containers:c})},onError:t=>{p.Analytics.taskFailed({taskName:"loom-recording",traceId:e,source:"videoRecordButton",containers:c,error:new Error(t)})}}})}}),[m,t,c]);const C=Object(s.useCallback)((()=>{p.Analytics.sendClickedButtonEvent({source:o,buttonName:"videoRecordButton",containers:c}),j(!0)}),[o,c,j]);if(null==m||!m.status().success)return null;const V=n.a.createElement("button",{id:e,className:r()(R.recordButton,{[i]:!!i}),ref:w,type:"button",title:u?"":x("record-loom-video-beta"),onClick:C},n.a.createElement(l,{size:"small",color:a}));return u?n.a.createElement(d.a,{content:x("record-loom-video-beta"),delay:100,hideTooltipOnMouseDown:!0},V):V}},"./node_modules/css-loader/dist/cjs.js?!./node_modules/postcss-loader/dist/cjs.js?!./node_modules/less-loader/dist/cjs.js?!./app/src/components/VideoRecordButton/VideoRecordButton.less":function(e,t,o){"use strict";var s=o("./node_modules/css-loader/dist/runtime/api.js"),n=o.n(s)()(!1);n.push([e.i,"._1PDugdH0NR--y- {\n  background: transparent;\n  width: 28px;\n  height: 28px;\n  margin: 2px 0 0;\n  padding: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n._1PDugdH0NR--y-:hover {\n  background-color: rgba(9, 30, 66, 0.08);\n}\n",""]),n.locals={recordButton:"_1PDugdH0NR--y-"},t.a=n}}]);
//# sourceMappingURL=video-record-button.3ba9efe8e31bdef5a26a.js.map