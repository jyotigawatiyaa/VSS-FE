(window.webpackJsonp=window.webpackJsonp||[]).push([[204],{"./app/src/components/TemplatePicker/TeamTemplatePicker.tsx":function(e,n,i){"use strict";i.r(n),i.d(n,"TeamTemplatePickerUnconnected",(function(){return A})),i.d(n,"TeamTemplatePicker",(function(){return C}));var a=i("./node_modules/react/index.js"),t=i.n(a),r=i("./node_modules/moment/moment.js"),s=i.n(r),d=i("./packages/session-cookie/index.ts"),o=i("./node_modules/js-cookie/src/js.cookie.js"),l=i.n(o),m=i("./packages/dates/index.ts"),c=i("./packages/atlassian-analytics/index.ts"),u=i("./packages/locale/index.ts"),p=i("./app/src/components/ComponentWrapper/index.ts"),k=i("./app/scripts/debug/constants.ts"),b=i("./packages/organizations/index.ts"),v=i("./packages/product-features/index.ts"),g=i("./packages/members/index.ts"),y=i("./node_modules/@apollo/client/react/hooks/useQuery.js");i("./node_modules/@apollo/client/react/hooks/useLazyQuery.js");function N(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,a)}return i}function O(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?N(Object(i),!0).forEach((function(n){T(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):N(Object(i)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}function T(e,n,i){return n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}const f={context:{operationName:"TeamTemplatePicker"}},S={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"TeamTemplatePicker"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"orgId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"member"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"StringValue",value:"me",block:!1}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"oneTimeMessagesDismissed"}},{kind:"Field",name:{kind:"Name",value:"idPremOrgsAdmin"}},{kind:"Field",name:{kind:"Name",value:"memberType"}},{kind:"Field",name:{kind:"Name",value:"idEnterprise"}},{kind:"Field",name:{kind:"Name",value:"enterpriseLicenses"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"idEnterprise"}},{kind:"Field",name:{kind:"Name",value:"type"}}]}},{kind:"Field",name:{kind:"Name",value:"confirmed"}},{kind:"Field",name:{kind:"Name",value:"organizations"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"idEnterprise"}},{kind:"Field",name:{kind:"Name",value:"products"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"organization"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"orgId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"idMemberCreator"}},{kind:"Field",name:{kind:"Name",value:"teamType"}},{kind:"Field",name:{kind:"Name",value:"products"}},{kind:"Field",name:{kind:"Name",value:"idEnterprise"}},{kind:"Field",name:{kind:"Name",value:"products"}},{kind:"Field",name:{kind:"Name",value:"boards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"idBoardSource"}}]}},{kind:"Field",name:{kind:"Name",value:"prefs"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"boardVisibilityRestrict"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"private"}},{kind:"Field",name:{kind:"Name",value:"org"}},{kind:"Field",name:{kind:"Name",value:"enterprise"}},{kind:"Field",name:{kind:"Name",value:"public"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"memberships"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"idMember"}},{kind:"Field",name:{kind:"Name",value:"memberType"}}]}}]}}]}}]};var j=i("./node_modules/@apollo/client/react/hooks/useMutation.js");function F(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,a)}return i}function P(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?F(Object(i),!0).forEach((function(n){D(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):F(Object(i)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}function D(e,n,i){return n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}const E={context:{operationName:"DismissTeamTemplatePicker"}},I={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DismissTeamTemplatePicker"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"memberId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"messageId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addOneTimeMessagesDismissed"},arguments:[{kind:"Argument",name:{kind:"Name",value:"memberId"},value:{kind:"Variable",name:{kind:"Name",value:"memberId"}}},{kind:"Argument",name:{kind:"Name",value:"messageId"},value:{kind:"Variable",name:{kind:"Name",value:"messageId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"oneTimeMessagesDismissed"}}]}}]}}]};var w=i("./packages/graphql/generated.tsx"),M=i("./app/src/components/TemplatePicker/TemplatePicker.tsx"),h=i("./packages/feature-flag-client/index.ts"),x=i("./app/src/components/TemplatePicker/types.ts"),V=i("./packages/error-reporting/index.ts");const _={[b.TeamTypes.Other]:x.a.Popular,[b.TeamTypes.SmallBusiness]:x.a.Business,[b.TeamTypes.Education]:x.a.Education,[b.TeamTypes.EngineeringIT]:x.a.Engineering,[b.TeamTypes.Marketing]:x.a.Marketing,[b.TeamTypes.HumanResources]:x.a.HumanResources,[b.TeamTypes.Operations]:x.a.Operations,[b.TeamTypes.SalesCRM]:x.a.SalesCRM},A=({orgId:e})=>{var n;const i=Object(h.useFeatureFlag)("teamplates.web.team-picker-template-list",{}),r=Object(u.languageParts)(u.currentLocale).language;let o;o=i[u.currentLocale]?i[u.currentLocale]:i[r]?i[r]:i.en;const[p,N]=Object(a.useState)(x.a.Popular),[T,F]=Object(a.useState)(!1),[D]=function(e){const n=P(P({},E),e);return j.a(I,n)}(),{data:A,loading:C}=function(e){const n=O(O({},f),e);return y.a(S,n)}({variables:{orgId:e},skip:!d.memberId}),z="team-template-picker-".concat(e),B=null==A?void 0:A.member,R=null==A?void 0:A.organization,L=(null==B?void 0:B.oneTimeMessagesDismissed)||[],U=null==R?void 0:R.idMemberCreator,Y=(null==R?void 0:R.name)||"",q=(null==R?void 0:R.boards)||[],H=!!B&&!!R&&Object(b.isMemberAdmin)(B,R);let J=null==A||null===(n=A.organization)||void 0===n?void 0:n.teamType;J||(J=b.TeamTypes.Other);let Q=!!B&&!!R&&Object(b.canSetVisibilityOnBoard)({org:R,boardVisibility:w.b.Org,isOrgAdmin:H});R&&R.idEnterprise&&(Q=Object(b.canSetVisibilityOnBoard)({org:R,boardVisibility:w.b.Enterprise,isOrgAdmin:H})),B&&B.idEnterprise&&(Q=!!B&&(!Object(g.isPaidManagedEnterpriseMember)(B)||v.ProductFeatures.isEnterpriseProduct(null==R?void 0:R.products[0])));let W=!1;if(!C){const n=s()("2020-03-04","YYYY-MM-DD");W=s()(Object(m.f)(e)).isBefore(n)||!!l.a.get("team-template-picker.simulateExistingOrg")||U===d.memberId}const G=Object(u.usesLanguages)(Object.keys(i))&&W&&Q&&!L.includes(z)&&!C;if(Object(a.useEffect)((()=>{G&&c.Analytics.sendViewedComponentEvent({componentType:"section",componentName:"teamTemplatePickerSection",source:Object(c.getScreenFromUrl)({orgName:Y}),containers:{organization:{id:e}},attributes:{teamType:J}})}),[e,J,G,Y]),Object(a.useEffect)((()=>{const e=_[J];e&&N(e)}),[J]),!G)return null;if(q.length>3)return T||(F(!0),D({variables:{memberId:"me",messageId:z},optimisticResponse:{__typename:"Mutation",addOneTimeMessagesDismissed:{id:"me",oneTimeMessagesDismissed:L.concat([z]),__typename:"Member"}}})),null;const K=q.map((({idBoardSource:e})=>e)),X=o[p].filter((e=>!K.includes(e)));if(!X.length)return null;return t.a.createElement(M.a,{templateIds:X,onDismiss:async()=>{c.Analytics.sendDismissedComponentEvent({componentType:"section",componentName:"teamTemplatePickerSection",source:Object(c.getScreenFromUrl)({orgName:Y}),containers:{organization:{id:e}},attributes:{teamType:J}});try{await D({variables:{memberId:"me",messageId:z},optimisticResponse:{__typename:"Mutation",addOneTimeMessagesDismissed:{id:"me",oneTimeMessagesDismissed:L.concat([z]),__typename:"Member"}}})}catch(e){Object(V.sendErrorEvent)(e,{tags:{ownershipArea:"trello-teamplates",feature:k.Feature.TeamTemplatePicker}})}},onTemplateClicked:n=>(c.Analytics.sendUIEvent({action:"clicked",actionSubject:"sectionItem",actionSubjectId:"templateTileSectionItem",source:"teamTemplatePickerSection",containers:{organization:{id:e},board:{id:n}}}),!0),onChangeCategory:({value:n})=>{c.Analytics.sendUIEvent({action:"clicked",actionSubject:"dropdownItem",actionSubjectId:"templatePickerCategoryDropdownItem",source:"templatePickerSection",attributes:{category:n,organization:{id:e}}}),N(n)},selectedCategory:p})},C=e=>t.a.createElement(p.ComponentWrapper,null,t.a.createElement(A,e))}}]);
//# sourceMappingURL=team-template-picker.61dfbc8ff794589bc99c.js.map